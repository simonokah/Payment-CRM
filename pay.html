<!DOCTYPE html>
<html>
<head>
    <title>Make Payment</title>
</head>
<body>
    <h2>Payment Page</h2>
    <p>Email: <span id="email"></span></p>
    <p>Amount: â‚¦<span id="amount"></span></p>
    <button id="payBtn" disabled>Pay Now</button>

    <script>
        // Extract email and amount from the URL
        const params = new URLSearchParams(window.location.search);
        const email = params.get("email");
        const amount = params.get("amount");

        // Display values if available
        document.getElementById("email").textContent = email || "Not provided";
        document.getElementById("amount").textContent = amount || "Not provided";

        // Enable Pay button only if email and amount are valid
        const payBtn = document.getElementById("payBtn");
        if (email && amount && !isNaN(amount)) {
            payBtn.disabled = false;
        }

        // Event listener for the "Pay Now" button
        payBtn.addEventListener("click", function () {
            const myHeaders = new Headers();
        myHeaders.append("Authorization", "Bearer sk_test_00d2224bee46497d2103d10892c6b6e8b499f260");
        myHeaders.append("Content-Type", "application/json");
  
        const raw = JSON.stringify({
            "email": email,
            "amount": parseFloat(amount) * 100 // Paystack uses kobo
        });
  
        const requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: raw,
            redirect: "follow"
        };
            fetch("https://api.paystack.co/transaction/initialize", requestOptions)
            .then(response => response.json())
            .then(data => {
                if (data.status && data.data && data.data.authorization_url) {
                    window.location.href = data.data.authorization_url;
                } else {
                    alert("Failed to generate payment link.");
                    console.error(data);
                }
            })
            .catch(error => {
                console.error(error);
                alert("Error initiating payment.");
            });
        });
    </script>
</body>
</html>
